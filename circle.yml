dependencies:
  pre:
    - curl https://archive.mozilla.org/pub/firefox/nightly/latest-mozilla-central/firefox-52.0a1.en-US.linux-x86_64.tar.bz2 | tar xj
test:
  override:
    - ./node_modules/.bin/eslint lib
    - |
      ./node_modules/.bin/jpm test --tbpl --binary ./firefox/firefox | tee jpm.tbpl
      # exit with exit code of jpm, not tee
      (exit ${PIPESTATUS[0]})
  post:
    - woodchipper --timeout 600000 < jpm.tbpl > $CIRCLE_TEST_REPORTS/jpm.xml
    - ./node_modules/.bin/jpm xpi && mv shield-recipe-client.xpi $CIRCLE_ARTIFACTS/shield-recipe-client.xpi
